<%= provide(:title, "#{@user.username}の観た映画リスト") %>

<div class="container-fluid user">
	<div class="profile">
    <h1>
      <% if @user.picture? == false %>
        <%= image_tag("panda.png", :size => "100x100", :alt => "profile") %>
      <% else %>
        <%= image_tag(@user.picture, :size => "100x100", :alt => "profile pic") %>
      <% end %>
      <%= @user.username %>
      <%= render 'follow_unfollow_button' if logged_in? %>
    </h1>
    <div class="stats">
      <%= render 'shared/stats' if logged_in? %>
    </div>

    <div class="lists center">
      <%= link_to "観た映画のリスト", :controller => "users", :action => "watched" %>
      <%= link_to "観たい映画のリスト", :controller => "users", :action => "want" %>
      <p>おすすめ映画のリスト</p>
    </div>
  </div>

  <div class="list">

		<h2>おすすめ作品のリスト</h2>

		<%= link_to "全部(#{@count})", :action => "watched" %>
		<%= link_to "自分が観たことのある映画",
								{ :action => "my_watched", :my_id => current_user.id } %>
		<p>自分が観たことのない映画(<%= @my_unwatched.count %>)</p>

		<table border="1">
	    <tr>
			<th>Poster</th>
			<th>Title</th>
			<th>Release Date</th>
			<th>Description</th>
			<th>Add at</th>
			<th>Action</th>
	    </tr>

	    <% @my_unwatched.each do |m| %>
	    	<% movie = Movie.details(m.movie_id) %>
	    	<tr>
	        <td>
	        	<%= image_tag("https://image.tmdb.org/t/p/w200#{movie["poster_path"]}",
	        								:alt => "poster") %>
	        </td>
	        <td>
	        	<%= link_to movie["title"],
	        							controller: "movies", action: "show", id: "#{movie["id"]}" %>
	        </td>
	        <td><%= movie["release_date"] %></td>
	        <td>
	        	<% if movie["overview"].blank? %>
	            情報がありません
	          <% else %>
	        		<%= movie["overview"] %>
	        	<% end %>
	        </td>
	        <td><%= m["created_at"].strftime('%Y/%m/%d') %></td>
	        <td>
	        	<% unless want_check(movie["id"]) %>
        			<% want_list = Movielist.find_by(user_id: current_user.id, listname: "want") %>
	        		<%= button_to "観たい", list_movies_create_want_from_other_path,
	      										:class => "btn btn-info btn-md",
	      										:params => {:movielist_id => want_list.id, :movie_id => movie["id"]} %>
	      		<% end %>
	      		<% watched_list = Movielist.find_by(user_id: current_user.id, listname: "watched") %>
        		<%= button_to "観た", list_movies_create_watched_from_other_path,
      										:class => "btn btn-info btn-md",
      										:params => {:movielist_id => watched_list.id, :movie_id => movie["id"]} %>
	        </td>

	    	</tr>
	    <% end %>
		</table>

	</div>
</div>