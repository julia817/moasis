<%= provide(:title, "#{@user.username}のおすすめリスト") %>

<div class="container-fluid user">
  <div class="profile">
    <h1>
      <% if @user.picture? == false %>
        <%= image_tag("panda.png", :size => "100x100", :alt => "profile") %>
      <% else %>
        <%= image_tag(@user.picture, :size => "100x100", :alt => "profile pic") %>
      <% end %>
      <%= @user.username %>
      <%= render 'follow_unfollow_button' if logged_in? %>
    </h1>
    <div class="stats">
      <%= render 'shared/stats' if logged_in? %>
    </div>

    <div class="lists center">
      <%= link_to "観た映画のリスト", :controller => "users", :action => "watched" %>
      <%= link_to "観たい映画のリスト", :controller => "users", :action => "want" %>
      <p>おすすめ映画のリスト</p>
    </div>
  </div>

  <div class="list">
    <% if @list.blank? %>
    	<h2>おすすめ作品のリスト（0本）</h2>
    <% else %>
      <% if current_user?(User.find(@movielist.user_id)) %>
    	  <h2>おすすめ作品のリスト（<%= @count %>）</h2>
      <% else %>
        <h2>おすすめ作品のリスト</h2>
      <% end %>

      <div class="addthis_inline_share_toolbox"></div>

      <div class="filter">
        <% if logged_in? %>
          <% unless current_user?(User.find(@movielist.user_id)) %>
            <% current_user_id = current_user.id %>
            <p>全部(<%= @count %>)</p>
            <%= link_to "自分が観たことのある映画(#{@my_watched.count})",
                        { :action => "my_watched", :my_id => current_user_id } %>
            <%= link_to "自分が観たことのない映画(#{@count-@my_watched.count})",
                        { :action => "my_unwatched", :my_id => current_user.id } %>
          <% end %>
        <% end %>
      </div>

    	<table border="1">
        <tr>
    			<th>Poster</th>
    			<th>Title</th>
    			<th>Release Date</th>
    			<th>Description</th>
    			<th>Add at</th>
          <th>Action</th>
        </tr>
        <% @list.each do |m| %>
        	<% movie = Movie.details(m.movie_id) %>
        	<tr>
            <td>
            	<%= image_tag("https://image.tmdb.org/t/p/w200#{movie["poster_path"]}",
            								:alt => "poster") %>
            </td>
            <td>
            	<%= link_to movie["title"],
            							controller: "movies", action: "show", id: "#{movie["id"]}" %>
            </td>
            <td><%= movie["release_date"] %></td>
            <td>
            	<% if movie["overview"].blank? %>
                情報がありません
              <% else %>
            		<%= movie["overview"] %>
            	<% end %>
            </td>
            <td><%= m["created_at"].strftime('%Y/%m/%d') %></td>
            <% if !logged_in? %>
              <%= button_to "観た", "/list_movies/create", :class => "btn btn-info" %>
              <%= button_to "観たい", "/list_movies/create", :class => "btn btn-info" %>
              <%= button_to "おすすめ", "/list_movies/create", :class => "btn btn-info" %>
            <% else %>
      				<% if current_user?(User.find(@movielist.user_id)) %>
              	<td>
                  <%= button_to "削除", list_movies_destroy_path,
                                :method => "delete",
                                :class => "btn btn-md btn-danger",
                                :data => { :confirm => "本当に削除しますか？" },
                                :params => {:movielist_id => @movielist.id, :movie_id => movie["id"]} %> 
                </td>
              <% else %>
                <td>
                  <!-- TODO -->
                </td>
              <% end %>
            <% end %>
        	</tr>
        <% end %>
    	</table>

    <% end %>
  </div>
</div>

<script type="text/javascript" src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-5befb8322ae303d6"></script>